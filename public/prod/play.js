(()=>{"use strict";var e={d:(s,a)=>{for(var o in a)e.o(a,o)&&!e.o(s,o)&&Object.defineProperty(s,o,{enumerable:!0,get:a[o]})},o:(e,s)=>Object.prototype.hasOwnProperty.call(e,s)};e.d({},{z:()=>ce});class s{constructor(e,s){this.number=e,this.color=s}getColor(){return this.color}getNumber(){return this.number}setNumber(e){this.number=e}setColor(e){this.color=e}generateRandomNumber(e=0,s){return Math.floor(Math.random()*(s-e)+e)}isCorrectGuess(e){return e===this.number}}function a(e){for(var a=0;a<e.length;a++)e[a]=new s(e[a].number,e[a].color);return e}const o=$("#dealt-card"),t=$(".attack"),n=$(".hold"),l=$(".game-result"),r=$(".game-status"),d=$(".modal-game-result");let c="YOU WIN",m="YOU LOSE",i="Enemy has disconnected!",u="You guessed all of <enemy>'s cards!",y="<enemy> guessed all your cards!";function C(e){return"black"==e?"white":"black"}function f(e){const s=e.getNumber(),a=e.getColor();null!==s?o.html(s):o.html(""),o.removeClass(C(a)),o.addClass(a)}function g(){$("#returnButton").click((()=>{d.removeClass("modal-in"),$("header").removeClass("display-none"),$("footer").removeClass("display-none"),$(".lobby").removeClass("display-none"),setTimeout((()=>{$(".desk-wrapper").removeClass("fade-in"),$(".main-bg").addClass("fade-in")}),1e3),setTimeout((()=>{$("header").removeClass("header-out"),$("footer").removeClass("footer-out"),$(".lobby").removeClass("fade-out"),d.addClass("display-none"),$(".desk-wrapper").addClass("display-none"),$(".enemy-disconnect").html("")}),1400)}))}function v(){t.click((()=>{ce.myTurn&&ce.socket.emit("attackMove",{guessTarget:ce.selectedCard,guessValue:ce.myGuessValue})})),n.click((()=>{ce.myTurn&&ce.socket.emit("holdMove")}))}const h=$("#guess-count"),p=$("#correct-guesses"),k=$("#guess-rate"),b=$("#stay-count"),w=$("#my-win-count"),T=$("#enemy-win-count"),x=$("#my-counter"),S=$("#enemy-counter");const G=$("#my-username"),V=$("#enemy-username"),I=$(".enemy-hand-container"),N=$(".guess-array"),Y=$(".decision-wrapper");function O(){G.removeClass("player-turn"),V.addClass("player-turn"),I.addClass("no-pointer-events"),N.addClass("guess-array-inactive"),o.removeClass("highlight-dealt-card"),Y.addClass("decision-fade-away"),j()}function j(){t.addClass("decision-inactive"),n.addClass("decision-inactive")}function M(){G.addClass("player-turn"),V.removeClass("player-turn"),I.removeClass("no-pointer-events"),N.removeClass("guess-array-inactive"),o.addClass("highlight-dealt-card"),Y.removeClass("decision-fade-away")}function D(e){$(e).removeClass("selected")}function A(){let e=localStorage.getItem("lang");null!==e&&fetch(`/assets/languages/${e}.json`).then((e=>e.json())).then((e=>{const s=e.dynamic;c=s.gameWon,m=s.gameLost,i=s.disconnectStatus,u=s.wonStatus,y=s.lostStatus}))}function B(e,s,a){l.removeClass("game-won"),l.removeClass("game-lost"),a?(l.html(c),r.html(i),l.addClass("game-won")):e?(l.html(c),r.html(u.replace("<enemy>",s)),l.addClass("game-won")):(l.html(m),r.html(y.replace("<enemy>",s)),l.addClass("game-lost")),d.removeClass("display-none"),setTimeout((()=>{d.addClass("modal-in"),e&&function(){const e=Date.now()+8e3;let s=["#ffffff"];s.push("#00bb00"),s.push("#e0c331"),function a(){confetti({zIndex:999,particleCount:2,angle:-30,spread:60,origin:{x:0,y:0},colors:s,startVelocity:90}),confetti({zIndex:999,particleCount:2,angle:-150,spread:60,origin:{x:1,y:0},colors:s,startVelocity:90}),Date.now()<e&&requestAnimationFrame(a)}()}()}),1600)}async function H(e,s){const a=$("#dealt-card").offset(),o=e.offset(),t={Y:a.top-o.top,X:a.left-o.left};(async function(e,s,a){e.hasClass("my-card")||e.hasClass("closed")?$.keyframe.define({name:`draw-${s.getColor()}-${s.getNumber()}`,"100%":{transform:`translate(${a.X}px, ${a.Y}px ) `}}):$.keyframe.define([{name:`draw-${s.getColor()}-${s.getNumber()}`,"0%":{color:`${C(s.getColor())}`,transform:"rotateY(0deg)"},"49%":{color:`${s.getColor()}`},"100%":{transform:`translate(${a.X}px, ${a.Y}px ) rotateY(180deg)`,color:`${s.getColor()}`}}])})(e,s,t).then((()=>{e.playKeyframe({name:`draw-${s.getColor()}-${s.getNumber()}`,duration:"0.4s",timingFunction:"ease",delay:"0s",direction:"reverse",fillMode:"both",complete:function(){e.css({"z-index":"10"})}})}))}function L(e){$(".hold").addClass("decision-inactive"),setTimeout((()=>{e.addClass("correct")}),600),setTimeout((()=>{e.removeClass("correct")}),1200)}function z(e,s){$(s).removeClass("selected"),$(s).addClass(e),setTimeout((()=>{$(s).removeClass(e)}),400)}var F=void 0,U=void 0;function E(){F.play()}function J(e){const s=Math.min(e,100)/100;F.volume(s),U.volume(s)}function K(e,s,a,o){const t=function(e,s){const a=$("<div>");return a.addClass("card"),a.addClass(s),a.addClass(e.getColor()),a.html(e.getNumber()),a}(e,o);!function(e,s,a){const o=$(`.${a}-card`),t=o.length;if(e.addClass(`${a}-card`),s===t){let s=$("#my-hand");"enemy"===a&&(s=$("#enemy-hand")),s.append(e)}else $(o[s]).before(e)}(t,s,a),"enemy"===a&&function(e){const s=$(".enemy-card");for(let a=e;a<s.length;a++){const e=$(s[a]);e.hasClass("open")?e.off("click"):e.click((()=>{if(ce.myTurn){$($(".enemy-card")[ce.selectedCard]).removeClass("selected"),e.addClass("selected"),ce.selectedCard=a,ce.socket.emit("selectCard",{guessTarget:ce.selectedCard}),X.removeClass("decision-inactive")}}))}}(s),H(t,e)}const X=$(".attack");function q(e){const s=$(".enemy-card")[e];$(s).off("click"),$(s).addClass("no-pointer-events")}let P;function R(){P.remove(),ce.calloutActive=!1}const W=$("#language-modal"),_=["en","it","ja"];function Q(e){fetch(`/assets/languages/${e}.json`).then((e=>e.json())).then((e=>{const s=e.content;for(let[e,a]of Object.entries(s))"here"!==e&&("contrib"===e&&(a=`${a} <a href="https://github.com/notvalproate/Algo-Game" target="_blank">${s.here}</a>`),$(`#${e}`).html(a))}))}const Z=$("#settings-modal"),ee=$("#volumeSlider"),se=$("#volumeIcon");let ae;function oe(){!function(){let e=localStorage.getItem("volume");null===e?ae=2:(e=JSON.parse(e),ae=ne(e.volume),ee.attr("value",`${e.volume}`),J(e.volume),te())}(),$("#settingsButton").click((()=>{Z.removeClass("display-none"),setTimeout((()=>{Z.addClass("settings-modal-fade-in")}),50)})),$("#closeButton").click((()=>{Z.removeClass("settings-modal-fade-in"),setTimeout((()=>{Z.addClass("display-none")}),500)})),ee.on("pointerup touchend",(()=>{const e=ee.val();localStorage.setItem("volume",JSON.stringify({volume:e})),ae=ne(e),te(),J(ee.val()),E()}))}function te(){se.removeClass("fa-volume-high"),se.removeClass("fa-volume-low"),se.removeClass("fa-volume-xmark"),0===ae?se.addClass("fa-volume-xmark"):1===ae?se.addClass("fa-volume-low"):se.addClass("fa-volume-high")}function ne(e){return e<=.1?0:e<=50?1:2}var le=[],re=[],de=0,ce={username:void 0,socket:void 0,myTurn:void 0,ready:!1,deckTop:void 0,selectedCard:0,myGuessValue:0,calloutActive:!1};$(document).ready((function(){const e=$("#ready-button"),o=$(".attack"),t=$(".hold"),n=$("#me"),l=$("#enemy");let r=l.html();const d=$("#ready-count"),c=$("#room-key").html();ce.username=$("#me").html();1==parseInt(d.html())&&l.addClass("player-ready"),window.history.pushState(null,"",`/${c}/play`),async function(){$.keyframe.define({name:"flip-white-card","0%":{transform:"rotateY(180deg)",color:"white"},"30%":{color:"white"},"31%":{color:"black"},"100%":{transform:"rotateY(0deg)"}}),$.keyframe.define({name:"flip-black-card","0%":{transform:"rotateY(180deg)",color:"black"},"30%":{color:"black"},"31%":{color:"white"},"100%":{transform:"rotateY(0deg)"}})}(),F=new Howl({src:["/assets/sounds/ding.ogg"]}),U=new Howl({src:["/assets/sounds/wrong.ogg"]}),setTimeout((()=>{$("header").removeClass("header-out"),$("footer").removeClass("footer-out"),$(".lobby").removeClass("fade-out")}),200),ce.socket=io({query:{username:ce.username,roomKey:c}}),ce.socket.on("disconnect",(()=>{window.location.href=window.location.href})),ce.socket.on("lobbyUpdate",(e=>{const s=e.usernames;r=function(e){let s=e[0];if(s===ce.username&&(s=e[1]),null!==s)return $("#enemy").html(s),$("#enemy-username").html(s),$("#enemy-user-hth").html(s),s;$("#enemy").html("...")}(s)})),ce.socket.on("readyUpdate",(s=>{d.html(s.readyCount);var a=s.userList[0];if(1!==s.userList.length){var o=s.userList[1];a.username!==ce.username&&([a,o]=[o,a]),o.ready?l.addClass("player-ready"):l.removeClass("player-ready")}else l.removeClass("player-ready");a.ready?(n.addClass("player-ready"),e.addClass("ready-status")):(n.removeClass("player-ready"),e.removeClass("ready-status"))})),ce.socket.on("startGame",(e=>{$(".lobby").addClass("fade-out"),$(".desk-wrapper").removeClass("display-none"),setTimeout((()=>{$("header").addClass("header-out"),$("footer").addClass("footer-out")}),1e3),setTimeout((()=>{$(".main-bg").removeClass("fade-in")}),1500),setTimeout((()=>{$(".lobby").addClass("display-none"),$("header").addClass("display-none"),$("footer").addClass("display-none"),$("#ready-button").removeClass("ready-status"),$(".desk-wrapper").addClass("fade-in"),ce.ready=!1,$("#enemy").removeClass("player-ready"),$("#me").removeClass("player-ready"),$("#ready-count").html("0")}),2300),ce.myTurn=e.yourTurn,ce.selectedCard=0,ce.deckTop=new s(e.deckTop.number,e.deckTop.color),f(ce.deckTop),j(),$("#my-hand").html(""),$("#enemy-hand").html(""),le=a(e.yourHand),re=a(e.enemyHand),function(e,s){for(let s=0;s<e.length;s++)K(e[s],s,"my","closed");for(let e=0;e<s.length;e++)K(s[e],e,"enemy","closed")}(le,re),ce.myTurn?M():O()})),ce.socket.on("highlightCard",(e=>{var s,a,o;!function(e){let s=$(".my-card");$(s[ce.selectedCard]).removeClass("selected"),ce.selectedCard=e,$(s[ce.selectedCard]).addClass("selected")}(e.index),s=ce.selectedCard,a=le[ce.selectedCard].getColor(),o=de,ce.myTurn||(ce.calloutActive&&P.remove(),P=$("<div>"),P.addClass("guess-callout"),P.addClass(a),P.html(o),$($(".my-card")[s]).prepend(P),ce.calloutActive=!0)})),ce.socket.on("updateButtonValue",(e=>{var s;de=e.buttonValue,s=de,P.html(s)})),ce.socket.on("correctMove",(e=>{ce.myTurn=e.yourTurn;var s=e.guessTarget,a=$(".enemy-card");let n=$(".my-card");var l,r;E(),ce.myTurn?(z("correct",a[s]),$(a[s]).html(ce.myGuessValue),$(a[s]).addClass("open"),o.addClass("decision-inactive"),t.removeClass("decision-inactive"),q(s),l=$(a[s]),r=re[s],l.playKeyframe({name:`flip-${r.getColor()}-card`,duration:"0.4s",timingFunction:"ease",delay:"0s"})):($(n[s]).removeClass("closed"),$(n[s]).addClass("open"),z("correct",n[s]))})),ce.socket.on("wrongMove",(e=>{const a=new s(e.nextDeckTop.number,e.nextDeckTop.color),o=e.insertIndex;let t=ce.deckTop;ce.myTurn=e.yourTurn,U.play(),ce.myTurn?(z("wrong",$(".my-card")[ce.selectedCard]),t.setNumber(e.value),re.splice(o,0,t),K(t,o,"enemy","open"),q(o),R(),M()):(z("wrong",$(".enemy-card")[ce.selectedCard]),le.splice(o,0,t),K(t,o,"my","open"),O()),f(a),ce.deckTop=a})),ce.socket.on("cardHeld",(e=>{const a=new s(e.nextDeckTop.number,e.nextDeckTop.color),o=e.insertIndex,t=ce.deckTop;ce.myTurn=e.yourTurn,ce.myTurn?(re.splice(o,0,t),K(t,o,"enemy","closed"),R(),D($(".my-card")[ce.selectedCard]),M()):(le.splice(o,0,t),K(t,o,"my","open"),function(e,s){const a=$($(".my-card")[e]);setTimeout((()=>{a.addClass("closed"),a.removeClass("open")}),s)}(o,500),D($(".enemy-card")[ce.selectedCard]),O()),f(a),ce.deckTop=a})),ce.socket.on("gameEnded",(e=>{let s=e.wonGame;var a;a=e.stats,h.html(a.totalGuesses),p.html(a.correctGuesses),k.html(`${a.correctGuessRate.toFixed(2)}%`),b.html(a.timesStayed),w.html(a.wins),T.html(a.losses),x.removeClass("game-won"),x.removeClass("game-lost"),x.removeClass("tie"),S.removeClass("game-won"),S.removeClass("game-lost"),S.removeClass("tie"),a.wins>a.losses?(x.addClass("game-won"),S.addClass("game-lost")):a.wins<a.losses?(x.addClass("game-lost"),S.addClass("game-won")):(x.addClass("tie"),S.addClass("tie")),e.enemyDisconnect?B(s,r,!0):(L(s?$(".enemy-card"):$(".my-card")),B(s,r,!1))})),ce.socket.on("rejected",(()=>{console.log("reconnect not allowed")})),ce.socket.on("afk-warning",(()=>{window.location.href="/afk"})),function(e){new ClipboardJS("#copy-key",{text:function(){return`https://playalgo.com/${e}/play`}}).on("success",(e=>{e.clearSelection()}))}(c),$("#ready-button").click((()=>{ce.ready?ce.ready=!1:ce.ready=!0,ce.socket.emit("readyConfirmation",{ready:ce.ready})})),g(),v(),function(){const e=$(".guess-button");for(let s=0;s<12;s++)$(e[s]).click((()=>{ce.myTurn&&($(e[ce.myGuessValue]).removeClass("guess-button-selected"),ce.myGuessValue=s,$(e[ce.myGuessValue]).addClass("guess-button-selected"),ce.socket.emit("buttonClicked",{buttonValue:ce.myGuessValue}))}))}(),A(),function(e){$("#languageButton").click((()=>{W.removeClass("display-none"),setTimeout((()=>{W.addClass("language-modal-fade-in")}),50)}));for(let s=0;s<_.length;s++){const a=_[s];$(`#${a}Option`).click((()=>{localStorage.setItem("lang",a),Q(a),W.removeClass("language-modal-fade-in"),setTimeout((()=>{W.addClass("display-none")}),500),e()}))}}(A),function(){const e=localStorage.getItem("lang");null!==e&&"en"!==e&&Q(e)}(),oe()}))})();